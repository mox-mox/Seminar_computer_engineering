\begin{tikzpicture}[scale=0.3]
	\pgfmathsetmacro{\memBlocks}{3};
	\pgfmathsetmacro{\ways}{4};





	%{{{ Mem

	\node(dummy) at (-5, 0) {};
	\pgfmathsetmacro{\memWidth}{25};
	\coordinate (memA) at (0,0);
	\coordinate (memB) at ($ (memA) + (2*\memWidth,0) $);

	\draw[-,   >=latex',                               thick] ($ (memA) + (0,10) $) to node[auto, swap] {}($ (memA) + (0,220) $);
	\draw[-,   >=latex',                               thick] ($ (memB) + (0,10) $) to node[auto, swap] {}($ (memB) + (0,220) $);
	\node[font=\normalsize] at ($ (memA) + (\memWidth,-10) $) {\textbf{Main Memory}};
	\foreach \i in {0,...,\memBlocks}
	{
		\pgfmathsetmacro{\y}{-40+\i*70};
		\coordinate (set\i) at ($ (memA) + (0,\y) $);
		\draw[-, >=latex', ultra thick, loosely dotted] ($ (set\i) + (\memWidth,43) $) to node[auto, swap] {}($ (set\i) + (\memWidth,60) $);
    }
	\foreach \i in {0,...,\number\numexpr\memBlocks-1\relax}
	{
		\pgfmathsetmacro{\y}{30+\i*70};
		\draw[-, >=latex', ultra thick] ($ (memA) + (0,\y)    $) to                       ($ (memB) + (0,\y)    $);
		\draw[-, >=latex',       thick] ($ (memA) + (0,\y+10) $) to                       ($ (memB) + (0,\y+10) $);
		\node at ($ (memB) + (10,\y+15) $) {$i^{th}$};
		\draw[-, >=latex',       thick] ($ (memA) + (0,\y+20) $) to node[above=-0.10] {Mem-block}($ (memB) + (0,\y+20) $);
		\draw[-, >=latex', ultra thick] ($ (memA) + (0,\y+30) $) to                       ($ (memB) + (0,\y+30) $);
		\draw[-, >=latex',       thick] ($ (memA) + (0,\y+10) $) to                       ($ (memB) + (0,\y+10) $);
    }
	%}}}


	%{{{ Cache

	\pgfmathsetmacro{\cacheWidth}{35};
	\coordinate (cacheA) at ($ (memA) + (150,0) $);
	\coordinate (cacheB) at ($ (cacheA) + (2*\cacheWidth,0) $);

	\foreach \i in {0,...,\number\numexpr\ways-1\relax}
	{
		\pgfmathsetmacro{\y}{10+\i*55};
		\draw[-, >=latex',       thick] ($ (cacheA) + (0,\y)    $) to                                ($ (cacheA) + (0,\y+40) $);
		\draw[-, >=latex',       thick] ($ (cacheB) + (0,\y)    $) to                                ($ (cacheB) + (0,\y+40) $);
		\draw[-, >=latex', ultra thick] ($ (cacheA) + (0,\y)    $) to                                ($ (cacheB) + (0,\y)    $);
		\draw[-, >=latex',       thick] ($ (cacheA) + (0,\y+10) $) to node[above=-0.10] {Cache-block}($ (cacheB) + (0,\y+10) $);
		\draw[-, >=latex',       thick] ($ (cacheA) + (0,\y+20) $) to                                ($ (cacheB) + (0,\y+20) $);
		\draw[-, >=latex', ultra thick] ($ (cacheA) + (0,\y+40) $) to                                ($ (cacheB) + (0,\y+40) $);
		\node at ($ (cacheA) + (5,\y+45) $) {Set \i};
    }
	%}}}


\end{tikzpicture}
